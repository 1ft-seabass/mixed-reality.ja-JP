---
title: 空間アンカー
description: 安定したホログラムをレンダリングするために空間アンカーを使用するためのベスト プラクティス。
author: thetuvix
ms.author: alexturn
ms.date: 02/24/2019
ms.topic: article
ms.localizationpriority: high
keywords: 座標系、空間座標系、ワールドスケール、ワールド、スケール、位置、向き、アンカー、空間アンカー、ワールドロック済み、ワールドロック、永続化、共有
ms.openlocfilehash: 16165194d040ad22f7885897eddcc65cf9dcaec3
ms.sourcegitcommit: f20beea6a539d04e1d1fc98116f7601137eebebe
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/05/2019
ms.locfileid: "65730860"
---
# <a name="spatial-anchors"></a>空間アンカー

空間アンカーは、システムが長期的に追跡する必要がある、ワールド内の重要な点を表します。 アンカーで固定されたホログラムを正確に固定するため、各アンカーには、必要に応じて他のアンカーや座標系に対して調整される[座標系](coordinate-systems.md)があります。  アンカーの座標系でホログラムをレンダリングすると、ホログラムの位置は常に最も正確なものになります。 これには、時間の経過と共に、ホログラムの位置を若干調整しなければならないという代償が伴います。システムは、現実世界に対してホログラムの位置を継続的に移動させる必要があるためです。

空間アンカーを永続化し、アプリ セッション間でおよびデバイス間で共有することもできます。
* ローカル空間アンカーをディスクに保存して後ほど読み込み直すと、アプリは 1 台の HoloLens デバイスの複数のアプリ セッション間で現実世界の同じ場所を判断できます。
* <a href="https://docs.microsoft.com/azure/spatial-anchors/overview" target="_blank">Azure 空間アンカー</a>を使用してクラウド アンカーを作成すると、アプリは複数の HoloLens、iOS および Android デバイス間で空間アンカーを共有できます。 各デバイスで同じ空間アンカーを使用してホログラムをレンダリングすると、現実世界の同じ場所ですべてのユーザーがホログラムを見ることができます。  これにより、リアルタイム共有エクスペリエンスを実現できます。
* <a href="https://docs.microsoft.com/azure/spatial-anchors/overview" target="_blank">Azure 空間アンカー</a>を使用して HoloLens、iOS および Android デバイスの間で非同期ホログラム永続化を行うこともできます。  永続的なクラウド空間アンカーを共有すると、永続化した同じホログラムを長時間にわたって複数のデバイスに表示できます。これらのデバイスが同じ時間と場所に居合わせていなくても問題ありません。

スタンディング スケールまたはルーム スケールで、直径 5 m 以内にあるケーブルが接続されたデスクトップ ヘッドセットを使用して体験する場合、通常は空間アンカーの代わりに[ステージ座標系](coordinate-systems.md#stage-frame-of-reference)を使用することができます。これにより、すべてのコンテンツをレンダリングする単一の座標系が提供されます。 ただし、建物のフロア全体を利用するなど、HoloLens を使用して 5 m 以上動き回るアプリでは、コンテンツを継続的に安定させるために空間アンカーが必要になる場合があります。

空間アンカーは、世界の中に固定するホログラムに適しています。空間アンカーは、一度配置すると移動させることはできません。 ユーザーに追従する動的ホログラムには、アンカーに代わる代替案があります。 動的ホログラムは、静止基準系 (Unity のワールド座標系の土台) または接続座標系を使用して配置することをお勧めします。

## <a name="best-practices"></a>ベスト プラクティス

以下の空間アンカー ガイドラインを使用すると、現実世界を正確に追跡する安定したホログラムをレンダリングできます。

### <a name="create-spatial-anchors-where-users-place-them"></a>空間アンカーはユーザーが配置した場所に作成する

ほとんどの場合、ユーザーが明示的に空間アンカーを配置すべきです。

たとえば、HoloLens のアプリで、ユーザーが[視線](gaze.md)を[空間マッピング](spatial-mapping.md)メッシュに向けることで、ホログラムを配置する場所を決めることができます。 ユーザーがホログラムを配置するためにタップすると、交点に空間アンカーを作成し、アンカーの座標系の原点にホログラムを配置します。

ローカル空間アンカーは、簡単かつ効率よく作成できます。複数のアンカーが基になるセンサー データを共有できる場合、システムはローカル空間アンカーの内部データを統合します。 通常は、ユーザーが明示的に配置したホログラムごとに新しいローカル空間アンカーを作成する必要があります。ただし、以下に記載されているホログラムの剛性グループなどは除きます。

### <a name="always-render-anchored-holograms-within-3-meters-of-their-anchor"></a>固定されたホログラムは必ずアンカーから 3 m にレンダリングする

空間アンカーは、アンカーの原点近くの座標系を安定させます。 ホログラムを原点から約 3 m 以上離れた場所にレンダリングすると、レバーアーム効果により、原点からの距離に比例した顕著な位置エラーが発生する可能性があります。 ユーザーがアンカーの近くにいる場合は、ホログラムはユーザーからも離れているため、うまく動作します。つまり、遠くにあるホログラムの角度誤差は小さくなります。 しかし、ユーザーが遠くにあるホログラムに近づくと、ユーザーの視界にあるホログラムは大きくなり、アンカーの原点が離れていることによるレバーアーム効果が顕著になります。

### <a name="group-holograms-that-should-form-a-rigid-cluster"></a>剛体クラスターを形成すべきグループ ホログラム

アプリにおいて、ホログラム同士の位置関係が固定されている場合、複数のホログラムで同じ空間アンカーを共有できます。

たとえば、部屋でホログラムの太陽系をアニメーションさせる場合は、すべての太陽系のオブジェクトが相対的にスムーズに動けるように、中心にある 1 つのアンカーに関連付けるとよいでしょう。 この場合、太陽系の個々の構成要素が直接アンカーの周囲を移動しますが、太陽系全体をアンカーで固定します。

ホログラムの安定性を維持するために重要なのは、上記の 3 m 規則に従うことです。

### <a name="render-highly-dynamic-holograms-using-the-stationary-frame-of-reference-instead-of-a-local-spatial-anchor"></a>ローカルの空間アンカーの代わりに静止基準系を使用して非常に動的なホログラムをレンダリングする

部屋を歩き回っているキャラクターやユーザーに近い壁のそばに浮かぶ UI など、非常に動的ホログラムがある場合は、ローカルの空間アンカーをスキップし、[静止基準系](coordinate-systems.md#stationary-frame-of-reference) (Unity では、WorldAnchor を使わずにワールド座標に直接ホログラムを配置することで実現できます) が提供する座標系に直接ホログラムをレンダリングすることをお勧めします。 静止基準系のホログラムは、ユーザーがホログラムから離れている場合、ドリフトする可能性がありますが。動的ホログラムでは、ホログラムは常に移動しているか常にユーザーのそばにいるため、ドリフトを最低限にとどめて目立たなくすることができます。

動的ホログラムにおける興味深いケースとして、ある固定の座標系から別の座標系にアニメーションするオブジェクトがあげられます。 たとえば、10 m 離れている 2 つの城で、それぞれに空間アンカーがあり、片方の城からもう片方の城に大砲の弾を発射するとします。 弾が発射された時点では、静止基準系の適切な場所にレンダリングして、最初の城が固定されている座標系上の大砲の位置に重なるようにすることができます。 その後、静止基準系にある弾道をたどって弾を 10 m 飛ばします。 弾がもう片方の城に到達したときに、2 番目の城が固定されている座標系に移動させ、その城の剛体とともに物理演算を行うことができます。

静止基準系はデバイス間で共有できないので、デバイス間で非常に動的ホログラムを共有している場合は、いずれかのクラウド空間アンカーを選んで親として機能させる必要があります。  ただし、この場合、ホログラムがすべてのデバイスで安定して表示されるように、動的ホログラムまたはそれを表示するデバイスのどちらかがアンカーから半径 3 m 以内に残る必要があります。

### <a name="avoid-creating-a-grid-of-spatial-anchors"></a>空間アンカーのグリッドを作成しない

ユーザーが動き回る場合、アプリで空間アンカーを規則的に並べたグリッドを作成し、動的なオブジェクトが動くにつれてアンカーからアンカーに移動させたくなるかもしれません。 ただし、これを行う場合、アプリで管理しなければならないことが多くなり、システム自体が内部的に保持しているディープ センサーのデータを活用することもできません。 このような場合は、前のセクションで説明したように、ホログラムを静止基準系に配置すると、少ない労力でより良い結果を得ることができます。

静的な領域の周辺に一連のクラウド空間アンカーをあらかじめ配置しておく場合、アンカーのグリッドを作成するのではなく、上記の原則の下でユーザーに表示される重要なホログラムの場所に空間アンカーを配置することを検討してください。  これにより、重要なホログラムを最大限に安定させることができます。

### <a name="release-local-spatial-anchors-you-no-longer-need"></a>不要になったローカル空間アンカーをリリースする

ローカル空間アンカーがアクティブな間、システムはそのアンカーの近くにあるセンサー データをそばに置き続けることを優先します。 空間のアンカーを使わなくなった場合、その座標系にアクセスしないようにします。 これにより、必要に応じて基となるセンサー データが削除されます。

これは、空間アンカー ストアに永続化させたローカル アンカーにとって特に重要です。 アンカーの背後にあるセンサー データは、今後のセッションでアプリがアンカーを見つけることができるように、永続的に保持されます。そのため、他のアンカーを追跡するために使用できる領域が少なくなります。 今後のセッションで再度見つけられるようにしなければならないローカル アンカーのみを永続化し、ローカル アンカーがユーザーにとって意味をなさないものになった時点でストアから削除するようにしてください。

クラウド空間のアンカーのストレージは、シナリオで必要とされるだけ拡張することができます。  クラウド アンカーは必要な数だけ格納し、ユーザーがそのアンカーを使ってホログラムを配置することがないことがわかった段階でリリースすることができます。

## <a name="see-also"></a>関連項目
* [座標系](coordinate-systems.md)
* [複合現実での共有エクスペリエンス](shared-experiences-in-mixed-reality.md)
* <a href="https://docs.microsoft.com/azure/spatial-anchors" target="_blank">Azure Spatial Anchors</a>
* [Unity の永続化](persistence-in-unity.md)
* [DirectX の空間アンカー](coordinate-systems-in-directx.md#place-holograms-in-the-world-using-spatial-anchors)
* [ケース スタディ - Mixed Reality で穴から覗く](case-study-looking-through-holes-in-your-reality.md)
