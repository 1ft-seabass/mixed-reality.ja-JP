---
title: Azure 空間アンカーチュートリアル-2. Azure 空間アンカーの保存、取得、共有
description: このコースを完了すると、Mixed Reality アプリケーション内で Azure 顔認識を実装する方法を学習することができます。
author: jessemcculloch
ms.author: jemccull
ms.date: 02/26/2019
ms.topic: article
keywords: Mixed Reality、Unity、チュートリアル、Hololens
ms.openlocfilehash: a24d15f0c0fff045c01f6070027b7defa87c2416
ms.sourcegitcommit: b6b76275fad90df6d9645dd2bc074b7b2168c7c8
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/11/2019
ms.locfileid: "73914455"
---
# <a name="2-saving-retrieving-and-sharing-azure-spatial-anchors"></a><span data-ttu-id="688a9-105">2. Azure 空間アンカーを保存、取得、共有する</span><span class="sxs-lookup"><span data-stu-id="688a9-105">2. Saving, retrieving, and sharing Azure Spatial Anchors</span></span>

<span data-ttu-id="688a9-106">このチュートリアルでは、HoloLens 2 のストレージにアンカー情報を保存することで、複数のアプリセッションにわたって Azure 空間アンカーを保存する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="688a9-106">In this tutorial, we will learn how to save our Azure Spatial Anchors across multiple app sessions by saving our anchor information to the HoloLens 2's storage.</span></span> <span data-ttu-id="688a9-107">また、このアンカー情報を複数デバイスのアンカーの配置のために他のデバイスと共有する方法についても説明します。</span><span class="sxs-lookup"><span data-stu-id="688a9-107">We will also learn how to share this anchor information to other devices for a multi-device anchor alignment.</span></span>

## <a name="objectives"></a><span data-ttu-id="688a9-108">目標</span><span class="sxs-lookup"><span data-stu-id="688a9-108">Objectives</span></span>

* <span data-ttu-id="688a9-109">アプリセッション間の永続化のために、HoloLens 2 ローカルディスクから Azure 空間アンカー情報を保存および取得する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="688a9-109">Learn how to save and retrieve Azure Spatial Anchor information from the HoloLens 2 local disk, for persistence between app sessions</span></span>

* <span data-ttu-id="688a9-110">マルチデバイスシナリオでユーザー間で Azure 空間アンカー情報を共有する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="688a9-110">Learn how to share Azure Spatial Anchor information between users in a multi-device scenario</span></span>

## <a name="instructions"></a><span data-ttu-id="688a9-111">手順</span><span class="sxs-lookup"><span data-stu-id="688a9-111">Instructions</span></span>

### <a name="persist-azure-anchors-between-app-sessions---save-anchor-id-to-disk"></a><span data-ttu-id="688a9-112">アプリセッション間で Azure のアンカーを保持する-アンカー ID をディスクに保存する</span><span class="sxs-lookup"><span data-stu-id="688a9-112">Persist Azure anchors between app sessions - Save anchor ID to Disk</span></span>

1. <span data-ttu-id="688a9-113">SaveAnchorToDisk prefab を検索し、シーンに追加します。</span><span class="sxs-lookup"><span data-stu-id="688a9-113">Search for and add the SaveAnchorToDisk prefab to your scene.</span></span> <span data-ttu-id="688a9-114">これには、2つのボタンと、使用可能な Azure Anchor Id を HoloLens 2 ストレージに保存するためのボタンと、ディスクから Id を取得するためのボタンがあります。</span><span class="sxs-lookup"><span data-stu-id="688a9-114">These include two buttons, one button for saving any available Azure Anchor IDs to the HoloLens 2 storage, and another for retrieving any IDs from the disk.</span></span>

![module2chapter2step1im](images/module2chapter2step1im.PNG)

2. <span data-ttu-id="688a9-116">次の手順に従って各ボタンを構成します。</span><span class="sxs-lookup"><span data-stu-id="688a9-116">Configure Each button according to the instructions below</span></span>

   - <span data-ttu-id="688a9-117">SaveToDisk という名前のボタンについては、Click イベントトリガーと On Click イベントトリガーの両方に新しいイベントを作成します。</span><span class="sxs-lookup"><span data-stu-id="688a9-117">For the Button named SaveToDisk, create a new event under the Button Pressed event trigger as well as the On Click event trigger.</span></span> <span data-ttu-id="688a9-118">ParentAnchor オブジェクトを空のフィールドにドラッグし、ParentAnchor オブジェクトの ASAmoduleScript コンポーネントから SaveAzureAnchorIDToDisk () メソッドを割り当てます。</span><span class="sxs-lookup"><span data-stu-id="688a9-118">Drag the ParentAnchor object into the empty field, and assign the SaveAzureAnchorIDToDisk() method from the ParentAnchor Object's ASAmoduleScript component.</span></span>
   
     > <span data-ttu-id="688a9-119">注: 一部のボタンは、シーン内の他のボタンと重なって表示される場合があります。</span><span class="sxs-lookup"><span data-stu-id="688a9-119">Note: some of the buttons may appear overlapping the other buttons in the scene.</span></span> <span data-ttu-id="688a9-120">ボタンの位置を自由に調整できます。</span><span class="sxs-lookup"><span data-stu-id="688a9-120">Feel free to adjust the button's positioning.</span></span>

![module2chapter2step2aim](images/module2chapter2step2aim.PNG)

![module2chapter2step2aim](images/module2chapter2step2bim.PNG)

![module2chapter2step2aim](images/module2chapter2step2cim.PNG)


   - <span data-ttu-id="688a9-124">GetFromDisk という名前のボタンについては、Click イベントトリガーおよび On Click イベントトリガーの下に新しいイベントを作成します。</span><span class="sxs-lookup"><span data-stu-id="688a9-124">For the Button named GetFromDisk, create a new event under the Button Pressed event trigger as well as the On Click event trigger.</span></span> <span data-ttu-id="688a9-125">ParentAnchor オブジェクトを空のフィールドにドラッグし、ParentAnchor オブジェクトの ASAmoduleScript コンポーネントから LoadAzureAnchorIDsFromDisk () メソッドを割り当てます。</span><span class="sxs-lookup"><span data-stu-id="688a9-125">Drag the ParentAnchor object into the empty field, and assign the LoadAzureAnchorIDsFromDisk() method from the ParentAnchor Object's ASAmoduleScript component.</span></span>

3. <span data-ttu-id="688a9-126">チュートリアル1の指示に従って、更新されたアプリケーションをデバイスにビルドします。</span><span class="sxs-lookup"><span data-stu-id="688a9-126">Follow the instructions from Tutorial 1 to build the updated application to your device.</span></span> <span data-ttu-id="688a9-127">前のレッスンで行ったように、[Azure アンカーの作成] ボタンを押した後、[ディスクに保存] ボタンを押して、Azure Anchor ID をディスクに保存できるようになりました。</span><span class="sxs-lookup"><span data-stu-id="688a9-127">After pressing the Create Azure Anchor button, as you did in the previous lesson, you may now save the Azure Anchor ID to disk by pressing the save to disk button.</span></span>

4. <span data-ttu-id="688a9-128">アプリケーションを再起動し、Azure セッションを開始して、[Load Anchor ID] を押します。次に、[Azure アンカーの検索] をクリックして、ディスクに保存した ID に関連付けられているアンカーを探します。</span><span class="sxs-lookup"><span data-stu-id="688a9-128">Restart the application, start the Azure Session, Press Load Anchor ID, and then press Locate Azure Anchor to locate the anchor associated with the ID we saved to the disk.</span></span> <span data-ttu-id="688a9-129">これで、以前にアンカーを保存した場所で、シーン全体が位置にスナップされるようになりました。</span><span class="sxs-lookup"><span data-stu-id="688a9-129">The entire scene should now snap into position, at the location you saved the anchor previously!</span></span>

### <a name="share-azure-anchors-between-multiple-devices"></a><span data-ttu-id="688a9-130">複数のデバイス間で Azure アンカーを共有する</span><span class="sxs-lookup"><span data-stu-id="688a9-130">Share Azure Anchors between multiple devices</span></span>

<span data-ttu-id="688a9-131">このセクションでは、複数のデバイス間で Azure Anchor ID を共有する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="688a9-131">In this section, we'll learn how to share the Azure Anchor ID between multiple devices.</span></span> <span data-ttu-id="688a9-132">これにより、複数のデバイスが同じアンカー ID に対して Azure に対してクエリを実行できるようになり、固定されたホログラムとシーンを空間的に調整できるようになります。</span><span class="sxs-lookup"><span data-stu-id="688a9-132">This will allow multiple devices to query Azure for the same anchor ID, allowing our anchored holograms and scenes to be spatially aligned.</span></span> <span data-ttu-id="688a9-133">空間の配置 (複数のデバイス間で同じ物理的な場所にある同じホログラムが表示されます) は、HoloLens 2 のローカル共有エクスペリエンスにとって重要です。</span><span class="sxs-lookup"><span data-stu-id="688a9-133">Spatial alignment (seeing the same holograms in the same physical location between multiple devices) is key to local shared experiences in the HoloLens 2.</span></span> <span data-ttu-id="688a9-134">デバイス間で azure Id に関する情報を転送するには、さまざまな方法があります。 Azure 空間アンカー共有エクスペリエンスチュートリアルの[チュートリアル](mrlearning-sharing(photon)-ch1.md)に記載されている方法があります。</span><span class="sxs-lookup"><span data-stu-id="688a9-134">There are many ways to transfer information regarding azure IDs between devices, including methods outlined in the Azure Spatial Anchors shared experiences tutorials [Tutorials](mrlearning-sharing(photon)-ch1.md).</span></span> <span data-ttu-id="688a9-135">この例では、単純な web サービスを使用して、デバイス間でアンカー Id をアップロードしてダウンロードします。</span><span class="sxs-lookup"><span data-stu-id="688a9-135">This example uses a simple web service to upload and download Anchor IDs between devices.</span></span>

1. <span data-ttu-id="688a9-136">階層に編成アンカーの事前作成を追加します。</span><span class="sxs-lookup"><span data-stu-id="688a9-136">Add the ShareAnchor prefab into your hierarchy.</span></span> <span data-ttu-id="688a9-137">この prefab は、2つの新しいボタンをシーンに追加します。1つはアンカー ID 情報のアップロード用で、もう1つはアンカー ID 情報をダウンロードするためのものです。</span><span class="sxs-lookup"><span data-stu-id="688a9-137">This prefab adds two new buttons to your scene, one for uploading anchor ID information and another for downloading anchor ID information.</span></span> 

![module2chapter2step5im](images/module2chapter2step5im.PNG)

2. <span data-ttu-id="688a9-139">次の手順に従って各ボタンを構成します。</span><span class="sxs-lookup"><span data-stu-id="688a9-139">Configure Each button according to the instructions below</span></span>

   - <span data-ttu-id="688a9-140">SendSharedAnchor という名前のボタンに対して、Click イベントトリガーおよび On Click イベントトリガーの下に新しいイベントを作成します。</span><span class="sxs-lookup"><span data-stu-id="688a9-140">For the Button named, SendSharedAnchor, create a new event under the Button Pressed event trigger as well as the On Click event trigger.</span></span> <span data-ttu-id="688a9-141">ParentAnchor オブジェクトを空のフィールドにドラッグし、ParentAnchor オブジェクトの ASAmoduleScript コンポーネントから、"/" メソッドを割り当てます。</span><span class="sxs-lookup"><span data-stu-id="688a9-141">Drag the ParentAnchor object into the empty field, and assign the ShareAnchor() method from the ParentAnchor Object's ASAmoduleScript component.</span></span>

![module2chapter2step6aim](images/module2chapter2step6aim.PNG)

![module2chapter2step6bim](images/module2chapter2step6bim.PNG)

   - <span data-ttu-id="688a9-144">GetSharedAnchor という名前のボタンに対して、Click イベントトリガーおよび On Click イベントトリガーの下に新しいイベントを作成します。</span><span class="sxs-lookup"><span data-stu-id="688a9-144">For the Button named, GetSharedAnchor, create a new event under the Button Pressed event trigger as well as the On Click event trigger.</span></span> <span data-ttu-id="688a9-145">ParentAnchor オブジェクトを空のフィールドにドラッグし、ParentAnchor オブジェクトの ASAmoduleScript コンポーネントから GetSharedAzureAnchor () メソッドを割り当てます。</span><span class="sxs-lookup"><span data-stu-id="688a9-145">Drag the ParentAnchor object into the empty field, and assign the GetSharedAzureAnchor() method from the ParentAnchor object's ASAmoduleScript component.</span></span>

3. <span data-ttu-id="688a9-146">[チュートリアル 1](mrlearning-base-ch1.md)の指示に従います。</span><span class="sxs-lookup"><span data-stu-id="688a9-146">Follow the instructions from [Tutorial 1](mrlearning-base-ch1.md).</span></span> <span data-ttu-id="688a9-147">更新されたアプリケーションをデバイスにビルドします。</span><span class="sxs-lookup"><span data-stu-id="688a9-147">to build the updated application to your device.</span></span> <span data-ttu-id="688a9-148">前のレッスンで行ったように、[Azure アンカーの作成] ボタンを押した後、[他のデバイスに共有] ボタンを押すと、Azure アンカー ID を他のデバイスに共有できるようになります。</span><span class="sxs-lookup"><span data-stu-id="688a9-148">After pressing the Create Azure Anchor button, as you did in the previous lesson, you may now share the Azure Anchor ID to other devices by pressing the Share To Other Device button.</span></span>

   > <span data-ttu-id="688a9-149">注: 親アンカーを選択し、親アンカースクリプトまで下にスクロールします。</span><span class="sxs-lookup"><span data-stu-id="688a9-149">Note: Select the parent anchor and scroll down to the parent anchor script.</span></span> <span data-ttu-id="688a9-150">パブリック共有 pin が一意であることを確認してください (pin を他の数値に変更することもできます)。そのため、共有すると、共有しているユーザーであることがわかります。</span><span class="sxs-lookup"><span data-stu-id="688a9-150">Ensure that your public sharing pin is unique (You can change the pin to some other number), so that when you share it, you know it is yours that you are sharing.</span></span> <span data-ttu-id="688a9-151">多数のユーザーが Azure のアンカーを共有している可能性があります。これにより、適切な Azure アンカーを共有していることを確認できます。</span><span class="sxs-lookup"><span data-stu-id="688a9-151">There could be thousands of users sharing their Azure anchors, so doing this will allow you to ensure you are sharing the correct Azure anchors.</span></span>
   > 

![module2chapter2step7bim](images/module2chapter2step7bim.PNG)

4. <span data-ttu-id="688a9-153">別の HoloLens 2 デバイスがある場合は、アプリケーションを起動し、Azure セッションを開始します。</span><span class="sxs-lookup"><span data-stu-id="688a9-153">If you have another HoloLens 2 device, start the application and then start the Azure Session.</span></span> <span data-ttu-id="688a9-154">[共有アンカー ID の取得] ボタンをクリックし、[Azure アンカーの検索] ボタンを押して、web サービスを使用して共有した ID に関連付けられているアンカーを探します。</span><span class="sxs-lookup"><span data-stu-id="688a9-154">Press the Get Shared Anchor ID button, and then press the Locate Azure Anchor button to locate the anchor associated with the ID we shared using the web service.</span></span> <span data-ttu-id="688a9-155">シーン全体が、他の HoloLens 2 デバイスに配置された位置にスナップするようになります。</span><span class="sxs-lookup"><span data-stu-id="688a9-155">The entire scene should now snap into position, at where it was placed on the other HoloLens 2 device!</span></span> <span data-ttu-id="688a9-156">HoloLens 2 が1つしかない場合は、アプリケーションを再起動して Azure セッションを開始し、[共有アンカー ID の取得] ボタンを押し、[Azure アンカーの検索] ボタンを押して ID に関連付けられているアンカーを見つけることで、機能をテストできます。ディスクに保存されます。</span><span class="sxs-lookup"><span data-stu-id="688a9-156">If you only have one HoloLens 2, you may still test functionality by restarting the application, starting the Azure Session, and then press the "Get Shared Anchor ID" button, and then press the "Locate Azure Anchor button" to locate the anchor associated with the ID we saved to the disk.</span></span> <span data-ttu-id="688a9-157">これで、以前にアンカーを保存した場所で、シーン全体が位置にスナップされるようになりました。</span><span class="sxs-lookup"><span data-stu-id="688a9-157">The entire scene should now snap into position, at the location you saved the anchor previously!</span></span>

## <a name="congratulations"></a><span data-ttu-id="688a9-158">結論</span><span class="sxs-lookup"><span data-stu-id="688a9-158">Congratulations</span></span>
<span data-ttu-id="688a9-159">このレッスンでは、azure 空間アンカー ID を HoloLens 2 のローカルディスクに保存することで、アプリケーションセッションとアプリケーションの再起動の間で Azure 空間アンカーを永続化する方法について学習しました。</span><span class="sxs-lookup"><span data-stu-id="688a9-159">In this Lesson you learned how to persist Azure Spatial Anchors between application sessions and application restarts by saving the Azure Spatial Anchor ID to the local disk on HoloLens 2.</span></span> <span data-ttu-id="688a9-160">また、複数のデバイス間で Azure 空間アンカーを共有し、基本的なマルチユーザーの静的なホログラム共有エクスペリエンスを実現する方法についても学習しました。</span><span class="sxs-lookup"><span data-stu-id="688a9-160">You also learned how to share Azure Spatial Anchors between multiple devices for a basic multi-user, static hologram shared experience.</span></span>

<span data-ttu-id="688a9-161">共有モジュールの最後のレッスンで、完全に対話型のローカル共有エクスペリエンスの一部として Azure 空間アンカーを実装する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="688a9-161">We learn how to implement Azure Spatial Anchors as part of a fully interactive local shared experience during the final lesson of the Sharing Module.</span></span> <span data-ttu-id="688a9-162">ローカル共有エクスペリエンスには、同期された3D オブジェクトの位置、回転、スケール、各ユーザーの識別子、共有アプリケーションの状態などの機能が含まれる場合があります。</span><span class="sxs-lookup"><span data-stu-id="688a9-162">A local sharing experience may include functionality such as synchronized 3D object position, rotation, and scale, identifiers for each user, and shared application states.</span></span> <span data-ttu-id="688a9-163">Azure 空間アンカーは、各参加者に共通のアンカーを提供することで、これらの共有シナリオを強化します。これにより、すべてのユーザーが同じ物理的な場所に仮想オブジェクトを表示できるようになります。</span><span class="sxs-lookup"><span data-stu-id="688a9-163">Azure Spatial Anchors enhances these shared scenarios by providing each participant with a common anchor that lets all users see virtual objects in the same physical location.</span></span> <span data-ttu-id="688a9-164">これは、HoloLens、Android、iOS デバイスなど、さまざまなデバイスプラットフォームで当てはまります。</span><span class="sxs-lookup"><span data-stu-id="688a9-164">This is true across a range of device platforms, including HoloLens, Android, and iOS devices.</span></span> <span data-ttu-id="688a9-165">共有エクスペリエンスを開発する方法については、共有モジュールのすべてのレッスンを完了してください。</span><span class="sxs-lookup"><span data-stu-id="688a9-165">To learn how to develop a shared experience, complete all lessons in the Sharing module.</span></span>

<span data-ttu-id="688a9-166">次のレッスンでは、リアルタイムのフィードバックをユーザーに提供する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="688a9-166">In the next Lesson, we will learn how to provide users with real-time feedback.</span></span> <span data-ttu-id="688a9-167">このフィードバックには、アンカーの作成、環境の理解の質、Azure セッションの状態に関する情報が含まれています。</span><span class="sxs-lookup"><span data-stu-id="688a9-167">This feedback will include information about Anchor creation, the quality of environment understanding, and the state of the Azure session.</span></span> <span data-ttu-id="688a9-168">フィードバックがないと、アンカーが Azure に正常にアップロードされたかどうか、環境の品質がアンカーの作成に十分であるか、現在の状態であるかをユーザーが認識できない可能性があります。</span><span class="sxs-lookup"><span data-stu-id="688a9-168">Without feedback, users may not know whether an anchor has successfully been upload to Azure, whether the quality of the environment is sufficient for anchor creation, or the current state.</span></span>

[<span data-ttu-id="688a9-169">次のレッスン: 3. Azure 空間アンカーフィードバックの表示</span><span class="sxs-lookup"><span data-stu-id="688a9-169">Next Lesson: 3. Displaying Azure Spatial Anchor feedback</span></span>](mrlearning-asa-ch3.md)

