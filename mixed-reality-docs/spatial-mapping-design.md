---
title: 空間マッピングの設計
description: 空間マッピング HoloLens 内での効果的な使用には、多くの要因を慎重に検討が必要です。
author: cre8ivepark
ms.author: dongpark
ms.date: 03/21/2018
ms.topic: article
keywords: Windows Mixed Reality、デザイン、空間のマッピング、HoloLens、surface の再構築、メッシュ
ms.openlocfilehash: d2ddcbf9458769a60cd3ed2871c5f3405c75f10c
ms.sourcegitcommit: 384b0087899cd835a3a965f75c6f6c607c9edd1b
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/12/2019
ms.locfileid: "59597884"
---
# <a name="spatial-mapping-design"></a>空間マッピングの設計

空間マッピング HoloLens 内での効果的な使用には、多くの要因を慎重に検討が必要です。

## <a name="device-support"></a>デバイスのサポート

<table>
<tr>
<th>機能</th><th style="width:150px"> <a href="hololens-hardware-details.md">HoloLens</a></th><th style="width:150px"> <a href="immersive-headset-hardware-details.md">イマーシブ ヘッドセット</a></th>
</tr><tr>
<td> 空間マッピング</td><td style="text-align: center;"> ✔️</td><td style="text-align: center;"></td>
</tr>
</table>

## <a name="why-is-spatial-mapping-important"></a>空間マッピングが重要な理由

空間マッピングでは、実際の画面上のオブジェクトを配置することです。 これにより、ユーザーの世界のアンカー オブジェクトと、現実世界の深さの四角形の活用します。その他のホログラムと現実世界のオブジェクトに基づいて、ホログラム occluding は、これらホログラムが自分のスペースでは実際にユーザーに納得させることができます。 浮いた立体またはユーザーの移動は変わらないと感じるホログラム実数として。 可能であれば、快適性のアイテムを配置します。

配置またはホログラム (単純な射影されたグリッドを使用する) を移動するときは、サーフェスを視覚化します。 ユーザーに知らせる、ホログラムに最適な設置でき、ホログラムを配置しようとしているスポットがまだマップされていないかどうか、ユーザーが表示されますが、これは役立ちます。 ことができます「ビルボード項目」ユーザーに向かって角度が過度に最終的にいる場合。

## <a name="what-influences-spatial-mapping-quality"></a>空間マッピングの品質に影響しますか。

最適なユーザー エクスペリエンスを提供するには、HoloLens によって収集される空間マッピング データの品質に影響する要因を理解しておく必要があります。

空間マッピング データのエラーは、3 つのカテゴリに分類されます。
* **穴**:空間マッピング データに実際の画面が表示されません。
* **Hallucinations**:サーフェスは、現実の世界ではない空間マッピング データに存在します。
* **バイアス**:空間マッピング データのサーフェスは、実際のサーフェスは、プッシュまたは抽出のいずれかで生成配置されます。

いくつかの要因は、頻度とこれらのエラーの重大度に影響します。

* **ユーザーの動き**
   * 環境内でユーザーがどのように移動するかを判断します度合いは、環境がスキャンされます、ため、ユーザーは、適切なスキャンを実現するためにガイダンスを必要があります。
   * スキャンするために使用するカメラは、70 度円錐 3.1 メーター距離の最大数、カメラから 0.8 メーターの最小値内のデータを提供します。 実際の画面は、このフィールドのビュー内でのみスキャンされます。 これらの値は将来のバージョンで変更されることに注意してください。
   * オブジェクトの 3.1 のメートル単位内のユーザーを取得しない場合、それがスキャンされません。
   * かどうか、ユーザーがのみ 0.8 メーター未満の距離からのオブジェクトを表示し、スキャンされません (ユーザーの手のスキャンが回避されます)。
   * 決してを表示する場合上方向 (これは通常かなり) し、ceiling は可能性がありますスキャンされません。
   * ユーザーが家具または壁の内側に探すことはありませんこれらによってオクルー ジョン オブジェクトはスキャンされません。
   * サーフェスでは、浅い角度ではなく、正面を向けたを表示したときより高い品質でスキャンする傾向があります。
   * 場合は、HoloLens の head 追跡システムが失敗した瞬間的には発生迅速なユーザーの動き、不適切なライティング、壁の特徴またはカメラが原因になる説明)、空間マッピング データのエラーをもたらします。 ユーザーを移動し、その環境をスキャンでは、時間の経過と共に、このようなエラーが修正されます。

* **画面の資料**
   * 現実世界の表面に素材は大きく異なります。 赤外線方法に影響するためのデータは反映は空間マッピングの品質に影響を与えます。
   * 小さい光が反映されるので、カメラに近いものになるまで、濃いサーフェスをスキャンできません可能性があります。
   * サーフェスの一部は、距離からスキャンするので、面の背後および場合によって、画面の場所に穴のエラーも導入が少なすぎるライトを反映するように濃い可能性があります。
   * 正面を向けた、表示したときに、および簡易角度から見たときではなく、特に光沢のあるサーフェスはスキャンのみ場合があります。
   * ミラー化の実際のスペースとサーフェス、印象は景色の反射を作成するため、可能性があります穴のエラーと hallucination エラーの両方。

* **シーンの移動**
   * 空間マッピングは、ユーザーの移動や左右のドアをなど、環境内の変更に迅速に適応します。
   * ただし、空間マッピングできますのみの変化に適応領域でその領域がのスキャンに使用するカメラを明確に表示されます。
   * このためには、この適合より実際には、穴または hallucination のエラーが発生することができますも遅延する可能性があります。
   * 例としては、ユーザーは友人をスキャンし、中、友人の余地がにします。 フレンド (hallucination エラー) の 'ghost' 表現は、ユーザーに戻されたときの周囲と、友人が立っていました領域を再スキャンまで、空間マッピングのデータで保持されます。

* **照明干渉**
   * シーンのアンビエント赤外線を妨げる可能性スキャンなど、強力な日光がウィンドウを通過します。
   * 特に光沢のあるサーフェスは、ライトのそれらの原因となるバイアス エラー オフ バウンス近くにあるサーフェスのスキャンに干渉する可能性があります。
   * 光沢のあるサーフェスがカメラに直接光を反映浮動空中 hallucinations の原因とするか、シーンの動きへの対応を行うことで、容量が近くに影響します。
   * 同じ部屋に 2 つの HoloLens デバイスは、互いを妨害しないようにしますが、5 つを超える HoloLens デバイスの存在干渉が発生する可能性があります。

しないか、またはこれらのエラーの一部を修正することがある可能性があります。 ただし、ユーザーが空間マッピング データのエラーがある場合でも、目標を実現できるようにアプリケーションを設計する必要があります。

## <a name="the-environment-scanning-experience"></a>環境の経験をスキャンします。

HoloLens はように、ユーザーはそれらの環境でサーフェスについて学習します。 時間の経過と共に、HoloLens を発見された環境のすべての部分のスキャンをビルドします。 また、環境の変化が見られたものと、スキャンを更新します。 このスキャンは、アプリの起動の間で自動的に保持されます。

空間マッピングを使用する各アプリケーションが 'スキャン エクスペリエンス;' を提供することを検討する必要があります。アプリケーションをアプリケーションが正しく機能するために必要なサーフェスをスキャンするユーザーに紹介するプロセス。

![スキャンの例](images/sr-mixedworld-140429-8pm-00068-1000px.png)<br>
*スキャンの例*

このスキャンのエクスペリエンスの性質は、各アプリケーションのニーズに応じて大幅に異なりますが、2 つの主要な原則は、その設計をガイドする必要があります。

まず、**ユーザーとの通信が大きな問題は明らかです**します。 ユーザーはアプリケーションの要件が満たされているかどうかを認識は常にします。 される満たされていない、ときにこれは、理由と、適切なアクションを実行する迅速に指導する必要があります、ユーザーにすぐにクリアが必要です。

次に、**効率性と信頼性のバランスを取るようにアプリケーションを試みる必要がある**します。 これを行うことが**確実に**アプリケーションがユーザー時間を節約する空間のマッピング データを自動的に分析する必要があります。 確実にそうことはできません、ときに、アプリケーションにする必要があります代わりに必要な追加情報を使用してアプリケーションを迅速に提供するユーザーが有効にします。

デザイン エクスペリエンスをスキャンする右のため、次のようなは、アプリケーションに適用可能な検討してください。

* **スキャンのエクスペリエンスはありません。**
   * アプリケーションが、ガイド付きのスキャン エクスペリエンスことがなく完全に機能可能性があります。これは、自然なユーザーの移動の途中で見られる画面について学習します。
   * たとえばユーザーが holographic spraypaint 面を描画できるアプリケーションでは、サーフェスをユーザーに現在表示されているだけの知識が必要です。
   * 環境が完全にスキャン既に、HoloLens を使用して時間の多くが、ユーザーに費やして既にいずれかである場合。
   * 留意ただし空間マッピングで使用されるカメラのみを表示できることも、ユーザー、3.1 m 空間マッピングが登録されていないより離れているサーフェスの詳細について、ユーザーが監視に近い距離から過去にしない限り、します。
   * サーフェスがスキャンされて、ユーザーが理解できるように、アプリケーションがこの影響を視覚的なフィードバックを提供するなどをスキャンした表面に仮想の影をキャストと、これらのサーフェス上ホログラムを配置するユーザーが役立つ場合があります。
   * この場合は、空間表面オブザーバーの外接するボリュームがある必要があります本文ロックに各フレームを更新[空間座標系](coordinate-systems.md)ユーザーに続くようにします。

* **適切な場所を検索します。**
   * 特定の要件の場所で使用するため、アプリケーションを設計する可能性があります。
   * たとえば、holographic 力-fu を安全に練習ができるように、アプリケーションはユーザーを空の領域を必要があります。
   * アプリケーションは、初期のユーザーに特定の要件と通信し、クリア視覚的なフィードバックを強調する必要があります。
   * この例では、アプリケーションが必要な空の領域のエクステントを視覚化し、このゾーン内の不要なオブジェクトの存在を視覚的に強調表示する必要があります。
   * 空間表面オブザーバーの外接するボリューム、この場合の世界ロックを使用する必要があります[空間座標系](coordinate-systems.md)選択した場所にします。

* **サーフェスの適切な構成が見つかりません**
   * アプリケーションは、ミラーの holographic hall を作成する壁の対立、たとえば 2 つの大きな、サーフェスの特定の構成をフラット、必要があります。
   * このような場合、アプリケーションに適したサーフェスを検出し、それらにユーザーを直接空間マッピングによって提供されるサーフェスを分析する必要があります。
   * ユーザーは、アプリケーションの表面の解析が完全に信頼できる場合、フォールバック オプションにすることが必要です。 たとえば、アプリケーションが平らな壁として戸口を正しく識別する場合、ユーザーにはこのエラーを修正する簡単な方法必要があります。

* **環境の一部をスキャンします。**
   * アプリケーションは、ユーザーの指示に従って、環境の一部のみをキャプチャにすることがあります。
   * たとえば、アプリケーションは、ため、ユーザーが販売したい家具の holographic 分類された広告を投稿、部屋の一部をスキャンします。
   * ここでは、アプリケーションは、スキャン中に、ユーザーが確認されたリージョン内の空間マッピング データをキャプチャする必要があります。

* **全体のルームをスキャンします。**
   * アプリケーションでは、すべてのユーザーの背後にあるものも含め、現在のルームのサーフェスのスキャンを必要があります。
   * たとえば、ゲームでは、Gulliver の役割の耐え忍んですべての方向からに近づいている小さな Lilliputians 数百からユーザーを配置することがあります。
   * ルームの現在の表面の数を決定する必要があります、アプリケーションで、このような場合、既にスキャンされているし、大きなギャップを埋めるために、ユーザーの視線の先を指示します。
   * このプロセスにキーでは、サーフェスがまだスキャンされていないユーザーに対してチェック ボックスをオフになっている視覚的なフィードバックを提供します。 アプリケーションを使用できますたとえば[距離ベースのフォグ](https://msdn.microsoft.com/library/windows/desktop/bb173401%28v=vs.85%29.aspx)空間マッピング サーフェスでカバーされていない領域を視覚的に強調表示します。

* **環境の初期スナップショットします。**
   * アプリケーションは、初期 'snapshot' を考慮して、環境内のすべての変更を無視する必要があります。
   * これは、環境の初期状態に密結合は、ユーザーが作成したデータの中断を回避するために適切な可能性があります。
   * ここでは、アプリケーションください空間マッピング データのコピーを初期状態で、スキャンが完了したら。
   * アプリケーションでは、ホログラムが環境によって正しくオクルー ジョンする場合は、空間マッピング データの更新を受信し続ける必要があります。
   * 空間マッピング データの継続的な更新では、以前と現在の状態を環境の間の相違点の明確化、ユーザーに、発生した変更を視覚化することもできます。

* **環境のユーザーが開始したスナップショットを取得します。**
   * アプリケーションのみ、ユーザーが指示されたときの環境の変化に応答します。
   * たとえば、ユーザーは、異なる時点でそのポーズをキャプチャすることで '像' 友人の複数の 3D を作成できます。

* **環境を変更するユーザーを許可します。**
   * ユーザーの環境に変更をリアルタイムで応答するアプリケーションを設計することがあります。
   * たとえば、カーテンの描画、ユーザーは、もう一方の側で実行されている holographic プレイのシーン変更をトリガーできます。

* **空間マッピング データのエラーを回避するために、ユーザーのガイド**
   * アプリケーションは、その環境をスキャンするときに、ユーザーにガイダンスを提供するとします。
   * 特定の種類を回避するために、ユーザーがこうの[空間マッピング データのエラー](spatial-mapping-design.md#what-influences-spatial-mapping-quality)、照らさ windows またはミラーから留まることで、たとえばします。

注意すべき 1 つの追加詳細は、空間マッピング データの '範囲' は無制限ではありません。 空間マッピングは大規模なスペースの永続的なデータベースをビルド中にのみにデータをアプリケーションで使用できるユーザーを制限されたサイズの 'バブル' されます。 したがって長い回廊と、開始から十分にウォークの先頭から開始するかどうかは、最終的に先頭に戻る空間サーフェスは非表示になります。 これは、後使用可能な空間のマッピング データからが消えている、アプリケーションでこれらのサーフェスをキャッシュすることによってもちろん緩和できます。

## <a name="mesh-processing"></a>メッシュの処理

サーフェスで一般的な種類のエラーを検出し、フィルター処理、削除、または適切な空間のマッピング データの変更に役立ちます。

その空間のマッピング データは、現実世界のサーフェスを可能な限り忠実に注意してください、見当違い' '、サーフェスをシフトするリスクを適用するため、処理します。

メッシュの処理に役立つ可能性のさまざまな種類のいくつかの例を次に示します。

* **穴を埋める**
   * 濃いマテリアルの小さなオブジェクトのスキャンが失敗、周囲の画面に穴が終了します。
   * 穴に影響を与えるオクルー ジョン: ホログラム 'から' 穴と思われる非透過の実際の画面で確認できます。
   * 穴に影響を与える raycasts: raycasts サーフェスとの対話ユーザーを使用している場合にない可能性がありますこれら光線の穴を通過することが望ましい。 軽減策の 1 つでは、適切なサイズの領域をカバーする複数の raycasts のバンドルを使用します。 これができるように '外れ値' の結果をフィルター処理する場合でも、1 つ raycast 小さな穴を通過、集計結果が有効にもなります。 ただし、この方法が、計算コストもあります。
   * 物理運動の競合に影響を与える穴: 物理学のシミュレーションによって制御されるオブジェクト可能性があります、フロアの穴から削除して、失われます。
   * 表面メッシュには、このような穴をアルゴリズムに入力することになります。 ただし、windows 入り口など ' 実際穴' が設定されませんしないように、アルゴリズムを調整する必要があります。 難しいことがあります '虚数穴' から ' 実際穴' を確実に区別するために 'size' などのさまざまなヒューリスティックを実験する必要があります '境界図形' とします。

* **Hallucination の削除**
   * 反射、明るいライト、および移動するオブジェクトは、小規模な残留 'hallucinations' 空中で浮動ままにできます。
   * Hallucinations オクルー ジョンに影響を与える: hallucinations の前面に移動し、他ホログラム occluding 濃い図形として表示になる可能性があります。
   * Hallucinations に影響を与える raycasts: これら光線の背後にある画面ではなく、hallucination でしたヒット raycasts サーフェスとの対話ユーザーを使用している場合。 穴と同様、軽減する 1 つは、1 つの raycast ではなく多く raycasts を使用するが、もう一度これは計算コストで提供されます。
   * 影響の衝突の物理運動 hallucinations: 物理学のシミュレーションによって制御されるオブジェクトは、hallucination に対して一時的に停止し、領域の一見明確な領域を移動することができません。
   * このような hallucinations 表面メッシュからのフィルター処理することになります。 ただし、セキュリティ ホールと同様、lamp スタンドなど小規模の実際のオブジェクトおよびハンドルは削除されないため、アルゴリズムを調整する必要があります。

* **スムージング**
   * 空間マッピングは、大まかなや実際の対応と比べて ' ノイズの多い' として表示される画面を返す可能性があります。
   * 滑らかさに影響を与えます物理学の競合: 床面が大まかな場合は、ボールが物理的にシミュレートされた可能性がありますをロールバックできませんスムーズに全体にわたる直線。
   * 滑らかさがレンダリングに影響します。 場合サーフェスは直接ビジュアル化、大まかな表面法線をその外観に影響し、中断 'クリーン' を参照してください。 サーフェイスを描画するために使用するシェーダーに適切な光やテクスチャを使用してこの状況に対処することになります。
   * 表面メッシュ内の粗さを滑らかにすることになります。 ただし、対応する実際の画面から離れた場所でさらに、画面をプッシュこの可能性があります。 閉じるには対応関係を維持するが holographic サーフェスで正確かつ予測可能な対話を実現するためにユーザーを有効にする正確なホログラム オクルー ジョンを生成するために重要です。
   * 表面的な変更が必要なだけの場合は、頂点の位置を変更することがなく、頂点の法線を滑らかにするための十分な場合があります。

* **平面の検索**
   * 空間マッピングによって提供されるサーフェスでを実行するアプリケーション分析の多くの形式があります。
   * 1 つの簡単な例は、'プレーンの検索';サーフェスの境界付けられた、平面のほとんどのリージョンを識別します。
   * 平面のリージョンは、holographic 作業-サーフェス、holographic コンテンツに自動的に配置できるアプリケーションがリージョンとして使用できます。
   * 平面のリージョンでは、ガイドの最も要件に合わせて、サーフェスと対話をユーザーにユーザー インターフェイスを制限できます。
   * 平面のリージョンは、LCD 画面、テーブルまたはホワイト ボードなどの機能のオブジェクトに対応する holographic の現実の世界では、ように使用できます。
   * 平面のリージョンでは、テレビ ゲーム レベルの基礎を築くのプレイ領域を定義できます。
   * 平面の領域をフロアで参照する可能性が高い実在の人物の領域を識別することによって、現実の世界を移動する仮想エージェントと役立ちます。

## <a name="prototyping-and-debugging"></a>プロトタイプの作成とデバッグ

### <a name="useful-tools"></a>便利なツール
* [HoloLens のエミュレーター](using-the-hololens-emulator.md)物理 HoloLens へのアクセスなしの空間のマッピングを使用してアプリケーションを開発するために使用できます。 現実的な環境での HoloLens のライブ セッションをシミュレートすることができますが、すべてのデータとアプリケーションは通常で使用する、HoloLens モーション、空間座標系空間マッピング メッシュなど。 問題をデバッグおよびコードの変更を評価するために役立つ信頼性が高く、反復可能な入力を提供するために使用できます。
* シナリオを再現するには、ライブの HoloLens からネットワーク経由で空間マッピング データをキャプチャし、後続のデバッグ セッションで再利用をディスクに保存します。
* [Windows デバイスのポータル 3D 表示](using-the-windows-device-portal.md#3d-view)空間マッピング システム経由で現在使用可能な空間のサーフェスのすべてを表示する方法を提供します。 これにより、アプリケーション内の空間のサーフェスの比較の基準たとえば、空間のサーフェスが見つからないか、間違った場所に表示されているかどうかを簡単に判断できます。

### <a name="general-prototyping-guidance"></a>プロトタイプ作成の一般的なガイダンス
* [エラー](spatial-mapping-design.md#what-influences-spatial-mapping-quality)空間のマッピングでデータが厳密に、ユーザー エクスペリエンスに影響のさまざまな環境でアプリケーションをテストすることをお勧めします。
* 机に向ってなど、同じ場所に常にテストの習慣を身にトラップの取得はありません。 別の位置、図形、サイズおよびマテリアルのさまざまな形でテストしてください。
* 同様に、代理または録画済みのデータはデバッグに便利ですが同じのいくつかのテスト_ケースにも依存しないなります。 以前にキャッチより多くのさまざまなテストに関する重要な問題を検索するこの遅れる可能性があります。
* まったく同じ方法で実行、HoloLens、またはアプリケーションを使用することはできませんので、実際 (および理想的にはされていない coached) のユーザーとテストを実行することをお勧めを勧めします。 実際、驚かれるかもしれませんが分岐する方法のユーザーの動作、サポート技術情報と前提条件を指定できます。

## <a name="see-also"></a>関連項目
* [ルームのスキャンの視覚化](room-scan-visualization.md)
* [サウンドの空間の設計](spatial-sound-design.md)
* [Unity で永続化](persistence-in-unity.md)
